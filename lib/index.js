function e(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(i){if("default"!==i){var r=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return e[i]}})}}),t.default=e,t}var t=/*#__PURE__*/e(require("cesium")),i=require("./mapbox-gl"),r=document.createElement("canvas");r.style.imageRendering="pixelated",r.addEventListener("webglcontextlost",function(){return console.log("webglcontextlost")},!1),r.width=1024,r.height=1024,module.exports=/*#__PURE__*/function(){function e(e){var n,o,s=this;this.mapboxRenderer=void 0,this.ready=void 0,this.readyPromise=void 0,this.rectangle=void 0,this.tileSize=void 0,this.tileWidth=void 0,this.tileHeight=void 0,this.maximumLevel=void 0,this.minimumLevel=void 0,this.tileDiscardPolicy=void 0,this.credit=void 0,this.proxy=void 0,this.hasAlphaChannel=void 0,this.sourceFilter=void 0,this.tilingScheme=void 0,this.options=void 0,this.transformRequest=function(e){return s.options.headers?{url:e,headers:s.options.headers}:{url:e}},this.options=e,this.mapboxRenderer=new i.BasicRenderer({style:e.style,transformRequest:function(e){return s.transformRequest(e)}}),this.mapboxRenderer._canvas=r,this.mapboxRenderer._canvas.addEventListener("webglcontextrestored",function(){return s.mapboxRenderer._createGlContext()},!1),this.mapboxRenderer._createGlContext(),e.showCanvas&&this.mapboxRenderer.showCanvasForDebug(),this.ready=!1,this.readyPromise=this.mapboxRenderer._style.loadedPromise.then(function(){s.ready=!0}),this.tilingScheme=null!=(n=e.tilingScheme)?n:new t.WebMercatorTilingScheme,this.rectangle=this.tilingScheme.rectangle,this.tileSize=this.tileWidth=this.tileHeight=e.tileSize||1024,this.maximumLevel=e.maximumLevel||Number.MAX_SAFE_INTEGER,this.minimumLevel=e.minimumLevel||0,this.tileDiscardPolicy=void 0,this.credit=new t.Credit(e.credit||"",!1),this.proxy=new t.DefaultProxy(""),this.hasAlphaChannel=null==(o=e.hasAlphaChannel)||o,this.sourceFilter=e.sourceFilter}var n=e.prototype;return n.createTile=function(){var e=document.createElement("canvas");e.width=this.tileSize,e.height=this.tileSize,e.style.imageRendering="pixelated";var t=e.getContext("2d");return t&&(t.globalCompositeOperation="copy"),e},n.canvasToImage=function(e){try{var t=new Image;return Promise.resolve(new Promise(function(i){t.onload=function(){i(t)},t.crossOrigin="",t.src=e.toDataURL("image/png")}))}catch(e){return Promise.reject(e)}},n.requestImage=function(e,t,i,r){var n=this;if(void 0===r&&(r=!0),i>this.maximumLevel||i<this.minimumLevel)return Promise.reject(void 0);this.mapboxRenderer.filterForZoom(i);var o=[];return this.mapboxRenderer.getVisibleSources(i).forEach(function(r){o.push({source:r,z:i,x:e,y:t,left:0,top:0,size:n.tileSize})}),new Promise(function(e,t){var i=n.createTile(),s=n.mapboxRenderer.renderTiles(i.getContext("2d"),{srcLeft:0,srcTop:0,width:n.tileSize,height:n.tileSize,destLeft:0,destTop:0},o,function(o){try{var a=function(){if(o)t(void 0);else{var a=function(){if(r)return s.consumer.ctx=null,Promise.resolve(n.canvasToImage(i)).then(function(t){var i,r;e(t),n.mapboxRenderer.releaseRender(s),null==(i=n.mapboxRenderer._style.sourceCaches)||null==(r=i.origin)||r._tileCache.reset()});e(s)}();if(a&&a.then)return a.then(function(){})}}();return Promise.resolve(a&&a.then?a.then(function(){}):void 0)}catch(e){return Promise.reject(e)}})})},n.pickFeatures=function(e,i,r,n,o){var s,a=this;return null==(s=this.requestImage(e,i,r,!1))?void 0:s.then(function(e){var i,s,l=a.mapboxRenderer.getVisibleSources(r);l=a.sourceFilter?a.sourceFilter(l):l;var c=[],h=t.Math.toDegrees(n),u=t.Math.toDegrees(o);return l.forEach(function(e){c.push({data:a.mapboxRenderer.queryRenderedFeatures({source:e,renderedZoom:r,lng:h,lat:u,tileZ:r})})}),console.log(c),e.consumer.ctx=void 0,a.mapboxRenderer.releaseRender(e),null==(i=a.mapboxRenderer._style.sourceCaches)||null==(s=i.origin)||s._tileCache.reset(),c})},e}();
//# sourceMappingURL=index.js.map
