!function(e,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i(require("cesium/Cesium"),require("pbf-basic-render")):"function"==typeof define&&define.amd?define(["cesium/Cesium","pbf-basic-render"],i):(e||self).mvtImageryProvider=i(e.Cesium,e.pbfBasicRender)}(this,function(e,i){function t(e){if(e&&e.__esModule)return e;var i=Object.create(null);return e&&Object.keys(e).forEach(function(t){if("default"!==t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(i,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})}}),i.default=e,i}var r=/*#__PURE__*/t(e);/*#__PURE__*/
return function(){function e(e){var t,o,n=this;this.mapboxRenderer=void 0,this.ready=void 0,this.readyPromise=void 0,this.rectangle=void 0,this.tileSize=void 0,this.tileWidth=void 0,this.tileHeight=void 0,this.maximumLevel=void 0,this.minimumLevel=void 0,this.tileDiscardPolicy=void 0,this.proxy=void 0,this.hasAlphaChannel=void 0,this.sourceFilter=void 0,this.tilingScheme=void 0,this.options=void 0,this.transformRequest=function(e,i){return"Source"===i&&n.options.header?{url:e,headers:n.options.header}:{url:e}},this.options=e,this.mapboxRenderer=new i.BasicRenderer({style:e.style,transformRequest:function(e,i){return n.transformRequest(e,i)}}),e.showCanvas&&this.mapboxRenderer.showCanvasForDebug(),this.ready=!1,this.readyPromise=this.mapboxRenderer._style.loadedPromise.then(function(){n.ready=!0}),this.tilingScheme=null!=(t=e.tilingScheme)?t:new r.WebMercatorTilingScheme,this.rectangle=this.tilingScheme.rectangle,this.tileSize=this.tileWidth=this.tileHeight=e.tileSize||512,this.maximumLevel=e.maximumLevel||Number.MAX_SAFE_INTEGER,this.minimumLevel=e.minimumLevel||0,this.tileDiscardPolicy=void 0,this.proxy=new r.DefaultProxy(""),this.hasAlphaChannel=null==(o=e.hasAlphaChannel)||o,this.sourceFilter=e.sourceFilter,this.options=e}var t=e.prototype;return t.getTileCredits=function(e,i,t){return[]},t.createTile=function(){var e=document.createElement("canvas");e.width=this.tileSize,e.height=this.tileSize,e.style.imageRendering="pixelated";var i=e.getContext("2d");return i&&(i.globalCompositeOperation="copy"),e},t.requestImage=function(e,i,t,r){var o=this;if(void 0===r&&(r=!0),t>this.maximumLevel||t<this.minimumLevel)return Promise.reject(void 0);this.mapboxRenderer.filterForZoom(t);var n=[];return this.mapboxRenderer.getVisibleSources(t).forEach(function(r){n.push({source:r,z:t,x:e,y:i,left:0,top:0,size:o.tileSize})}),console.log("tilesSpec",n),new Promise(function(e,i){var t=o.createTile(),s=o.mapboxRenderer.renderTiles(t.getContext("2d"),{srcLeft:0,srcTop:0,width:o.tileSize,height:o.tileSize,destLeft:0,destTop:0},n,function(n){n?(console.error(n),i(void 0)):r?(s.consumer.ctx=void 0,e(t),o.mapboxRenderer.releaseRender(s)):e(s)})})},t.pickFeatures=function(e,i,t,o,n){var s,a=this;return null==(s=this.requestImage(e,i,t,!1))?void 0:s.then(function(e){var i=a.mapboxRenderer.getVisibleSources(t);i=a.sourceFilter?a.sourceFilter(i):i;var s=[],l=r.Math.toDegrees(o),u=r.Math.toDegrees(n);return i.forEach(function(e){s.push({data:a.mapboxRenderer.queryRenderedFeatures({source:e,renderedZoom:t,lng:l,lat:u,tileZ:t})})}),e.consumer.ctx=void 0,a.mapboxRenderer.releaseRender(e),s})},e}()});
//# sourceMappingURL=index.umd.js.map
